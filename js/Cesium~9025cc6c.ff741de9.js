(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Cesium~9025cc6c"],{"0c80":function(e,t,i){"use strict";var a=i("77af"),r=i("670c"),o=i("be18"),n=i("a561"),s=i("bef8"),u=i("2f63"),c=i("93da"),m=i("52f0"),d=i("713f"),h=i("c34a"),p=i("f806"),f=i("a307"),l={},_=new n["a"](0,0,0,1),v=new n["a"],g=new a["a"],b=new r["a"],C=new r["a"];l.wgs84ToWindowCoordinates=function(e,t,i){return l.wgs84WithEyeOffsetToWindowCoordinates(e,t,o["a"].ZERO,i)};var w=new n["a"],S=new o["a"];function T(e,t,i,a){var r=i.viewMatrix,s=m["a"].multiplyByVector(r,n["a"].fromElements(e.x,e.y,e.z,1,w),w),u=o["a"].multiplyComponents(t,o["a"].normalize(s,S),S);return s.x+=t.x+u.x,s.y+=t.y+u.y,s.z+=u.z,m["a"].multiplyByVector(i.frustum.projectionMatrix,s,a)}var D=new s["a"](Math.PI,c["a"].PI_OVER_TWO),E=new o["a"],y=new o["a"];l.wgs84WithEyeOffsetToWindowCoordinates=function(e,t,i,a){var n=e.frameState,s=l.computeActualWgs84Position(n,t,_);if(Object(u["a"])(s)){var w=e.canvas,S=g;S.x=0,S.y=0,S.width=w.clientWidth,S.height=w.clientHeight;var O=e.camera,x=!1;if(n.mode===f["a"].SCENE2D){var P=e.mapProjection,R=D,F=P.project(R,E),M=o["a"].clone(O.position,y),I=O.frustum.clone(),j=m["a"].computeViewportTransformation(S,0,1,new m["a"]),N=O.frustum.projectionMatrix,L=O.positionWC.y,A=o["a"].fromElements(c["a"].sign(L)*F.x-L,0,-O.positionWC.x),V=p["a"].pointToGLWindowCoordinates(N,j,A);if(0===L||V.x<=0||V.x>=w.clientWidth)x=!0;else{if(V.x>.5*w.clientWidth){S.width=V.x,O.frustum.right=F.x-L,v=T(s,i,O,v),l.clipToGLWindowCoordinates(S,v,b),S.x+=V.x,O.position.x=-O.position.x;var B=O.frustum.right;O.frustum.right=-O.frustum.left,O.frustum.left=-B,v=T(s,i,O,v),l.clipToGLWindowCoordinates(S,v,C)}else{S.x+=V.x,S.width-=V.x,O.frustum.left=-F.x-L,v=T(s,i,O,v),l.clipToGLWindowCoordinates(S,v,b),S.x=S.x-S.width,O.position.x=-O.position.x;var k=O.frustum.left;O.frustum.left=-O.frustum.right,O.frustum.right=-k,v=T(s,i,O,v),l.clipToGLWindowCoordinates(S,v,C)}o["a"].clone(M,O.position),O.frustum=I.clone(),a=r["a"].clone(b,a),(a.x<0||a.x>w.clientWidth)&&(a.x=C.x)}}if(n.mode!==f["a"].SCENE2D||x){if(v=T(s,i,O,v),v.z<0&&!(O.frustum instanceof d["a"])&&!(O.frustum instanceof h["a"]))return;a=l.clipToGLWindowCoordinates(S,v,a)}return a.y=w.clientHeight-a.y,a}},l.wgs84ToDrawingBufferCoordinates=function(e,t,i){if(i=l.wgs84ToWindowCoordinates(e,t,i),Object(u["a"])(i))return l.transformWindowToDrawingBuffer(e,i,i)};var O=new o["a"],x=new s["a"];l.computeActualWgs84Position=function(e,t,i){var a=e.mode;if(a===f["a"].SCENE3D)return o["a"].clone(t,i);var r=e.mapProjection,n=r.ellipsoid.cartesianToCartographic(t,x);if(Object(u["a"])(n)){if(r.project(n,O),a===f["a"].COLUMBUS_VIEW)return o["a"].fromElements(O.z,O.x,O.y,i);if(a===f["a"].SCENE2D)return o["a"].fromElements(0,O.x,O.y,i);var s=e.morphTime;return o["a"].fromElements(c["a"].lerp(O.z,t.x,s),c["a"].lerp(O.x,t.y,s),c["a"].lerp(O.y,t.z,s),i)}};var P=new o["a"],R=new o["a"],F=new m["a"];l.clipToGLWindowCoordinates=function(e,t,i){return o["a"].divideByScalar(t,t.w,P),m["a"].computeViewportTransformation(e,0,1,F),m["a"].multiplyByPoint(F,P,R),r["a"].fromCartesian3(R,i)},l.transformWindowToDrawingBuffer=function(e,t,i){var a=e.canvas,o=e.drawingBufferWidth/a.clientWidth,n=e.drawingBufferHeight/a.clientHeight;return r["a"].fromElements(t.x*o,t.y*n,i)};var M=new n["a"],I=new n["a"];l.drawingBufferToWgs84Coordinates=function(e,t,i,a){var r=e.context,s=r.uniformState,d=s.currentFrustum,h=d.x,p=d.y;e.frameState.useLogDepth&&(i=Math.pow(2,i*c["a"].log2(p+1))-1,i=p*(1-h/i)/(p-h));var f,l=e.view.passState.viewport,_=n["a"].clone(n["a"].UNIT_W,M);_.x=(t.x-l.x)/l.width*2-1,_.y=(t.y-l.y)/l.height*2-1,_.z=2*i-1,_.w=1;var v=e.camera.frustum;if(Object(u["a"])(v.fovy)){f=m["a"].multiplyByVector(s.inverseViewProjection,_,I);var g=1/f.w;o["a"].multiplyByScalar(f,g,f)}else Object(u["a"])(v._offCenterFrustum)&&(v=v._offCenterFrustum),f=I,f.x=.5*(_.x*(v.right-v.left)+v.left+v.right),f.y=.5*(_.y*(v.top-v.bottom)+v.bottom+v.top),f.z=.5*(_.z*(h-p)-h-p),f.w=1,f=m["a"].multiplyByVector(s.inverseView,f,f);return o["a"].fromCartesian4(f,a)},t["a"]=l},"7fe1":function(e,t,i){"use strict";var a=i("bd8d"),r=i("2f63"),o=i("7d62"),n=i("e42d"),s=i("f845"),u=i("ac3b"),c=i("6ef5"),m=i("8a65"),d=i("3550"),h=i("6c84"),p=i("a913"),f=i("3022"),l=i("03f1"),_=i("23b6");function v(){this._colorTexture=void 0,this._idTexture=void 0,this._depthStencilTexture=void 0,this._depthStencilRenderbuffer=void 0,this._framebuffer=void 0,this._idFramebuffer=void 0,this._idClearColor=new a["a"](0,0,0,0),this._useHdr=void 0,this._clearCommand=new s["a"]({color:new a["a"](0,0,0,0),depth:1,owner:this})}function g(e){e._framebuffer=e._framebuffer&&e._framebuffer.destroy(),e._idFramebuffer=e._idFramebuffer&&e._idFramebuffer.destroy(),e._colorTexture=e._colorTexture&&e._colorTexture.destroy(),e._idTexture=e._idTexture&&e._idTexture.destroy(),e._depthStencilTexture=e._depthStencilTexture&&e._depthStencilTexture.destroy(),e._depthStencilRenderbuffer=e._depthStencilRenderbuffer&&e._depthStencilRenderbuffer.destroy(),e._depthStencilIdTexture=e._depthStencilIdTexture&&e._depthStencilIdTexture.destroy(),e._depthStencilIdRenderbuffer=e._depthStencilIdRenderbuffer&&e._depthStencilIdRenderbuffer.destroy(),e._framebuffer=void 0,e._idFramebuffer=void 0,e._colorTexture=void 0,e._idTexture=void 0,e._depthStencilTexture=void 0,e._depthStencilRenderbuffer=void 0,e._depthStencilIdTexture=void 0,e._depthStencilIdRenderbuffer=void 0}v.prototype.update=function(e,t,i){var a=t.width,o=t.height,s=this._colorTexture;if(!Object(r["a"])(s)||s.width!==a||s.height!==o||i!==this._useHdr){g(this),this._useHdr=i;var v=i?e.halfFloatingPointTexture?c["a"].HALF_FLOAT:c["a"].FLOAT:c["a"].UNSIGNED_BYTE;this._colorTexture=new p["a"]({context:e,width:a,height:o,pixelFormat:n["a"].RGBA,pixelDatatype:v,sampler:new h["a"]({wrapS:_["a"].CLAMP_TO_EDGE,wrapT:_["a"].CLAMP_TO_EDGE,minificationFilter:l["a"].NEAREST,magnificationFilter:f["a"].NEAREST})}),this._idTexture=new p["a"]({context:e,width:a,height:o,pixelFormat:n["a"].RGBA,pixelDatatype:c["a"].UNSIGNED_BYTE,sampler:new h["a"]({wrapS:_["a"].CLAMP_TO_EDGE,wrapT:_["a"].CLAMP_TO_EDGE,minificationFilter:l["a"].NEAREST,magnificationFilter:f["a"].NEAREST})}),e.depthTexture?(this._depthStencilTexture=new p["a"]({context:e,width:a,height:o,pixelFormat:n["a"].DEPTH_STENCIL,pixelDatatype:c["a"].UNSIGNED_INT_24_8,sampler:new h["a"]({wrapS:_["a"].CLAMP_TO_EDGE,wrapT:_["a"].CLAMP_TO_EDGE,minificationFilter:l["a"].NEAREST,magnificationFilter:f["a"].NEAREST})}),this._depthStencilIdTexture=new p["a"]({context:e,width:a,height:o,pixelFormat:n["a"].DEPTH_STENCIL,pixelDatatype:c["a"].UNSIGNED_INT_24_8,sampler:new h["a"]({wrapS:_["a"].CLAMP_TO_EDGE,wrapT:_["a"].CLAMP_TO_EDGE,minificationFilter:l["a"].NEAREST,magnificationFilter:f["a"].NEAREST})})):(this._depthStencilRenderbuffer=new m["a"]({context:e,width:a,height:o,format:d["a"].DEPTH_STENCIL}),this._depthStencilIdRenderbuffer=new m["a"]({context:e,width:a,height:o,format:d["a"].DEPTH_STENCIL})),this._framebuffer=new u["a"]({context:e,colorTextures:[this._colorTexture],depthStencilTexture:this._depthStencilTexture,depthStencilRenderbuffer:this._depthStencilRenderbuffer,destroyAttachments:!1}),this._idFramebuffer=new u["a"]({context:e,colorTextures:[this._idTexture],depthStencilTexture:this._depthStencilIdTexture,depthStencilRenderbuffer:this._depthStencilIdRenderbuffer,destroyAttachments:!1})}},v.prototype.clear=function(e,t,i){var r=t.framebuffer;t.framebuffer=this._framebuffer,a["a"].clone(i,this._clearCommand.color),this._clearCommand.execute(e,t),t.framebuffer=this._idFramebuffer,a["a"].clone(this._idClearColor,this._clearCommand.color),this._clearCommand.execute(e,t),t.framebuffer=r},v.prototype.getFramebuffer=function(){return this._framebuffer},v.prototype.getIdFramebuffer=function(){return this._idFramebuffer},v.prototype.isDestroyed=function(){return!1},v.prototype.destroy=function(){return g(this),Object(o["a"])(this)},t["a"]=v},a307:function(e,t,i){"use strict";var a=i("0e25"),r={MORPHING:0,COLUMBUS_VIEW:1,SCENE2D:2,SCENE3D:3,getMorphTime:function(e){return e===r.SCENE3D?1:e!==r.MORPHING?0:void 0}};t["a"]=Object(a["a"])(r)},da97:function(e,t,i){"use strict";var a=i("77af"),r=i("cef5"),o=i("b482"),n=i("be18"),s=i("bef8"),u=i("bd8d"),c=i("9541"),m=i("71ce"),d=i("2384"),h=i("535a"),p=i("2f63"),f=i("9f1d"),l=i("7d62"),_=i("6cae"),v=i("21d7"),g=i("3d7f"),b=i("d940"),C=i("c1e2"),w=i("66bf"),S=i("5ed2"),T=i("93da"),D=i("52f0"),E=i("4b0f"),y=i("f0be"),O=i("713f"),x=i("c34a"),P=i("4e1a"),R=i("4dc8"),F=i("75b2"),M=i("6a29"),I=i("f806"),j=i("f845"),N=i("aec5"),L=i("de02"),A=i("b997"),V=i("a894"),B=i("d289"),k=i("6dc0"),W=i("e90c"),U=i("5770"),G=i("1331"),H=i("9dbf"),z=i("d150"),q=i("56d3"),Q=i("0b8f"),Y=i("c965"),Z=i("81e1"),K=i("ed8b"),J=i("9cff"),X=i("0838"),$=i("f3b8"),ee=i("6f08"),te=i("d57b"),ie=i("4436"),ae=i("482f"),re=i("1b40"),oe=i("01c0"),ne=i("3a8e"),se=i("d572"),ue=i("9e4a"),ce=i("894b"),me=i("738d"),de=i("a307"),he=i("0c80"),pe=i("55f9"),fe=i("2ac3"),le=i("1863"),_e=i("2f48");function ve(e){this._scene=e,this._currentTweens=[],this._morphHandler=void 0,this._morphCancelled=!1,this._completeMorph=void 0,this._morphToOrthographic=!1}ve.prototype.completeMorph=function(){Object(p["a"])(this._completeMorph)&&this._completeMorph()},ve.prototype.morphTo2D=function(e,t){Object(p["a"])(this._completeMorph)&&this._completeMorph();var i=this._scene;this._previousMode=i.mode,this._morphToOrthographic=i.camera.frustum instanceof O["a"],this._previousMode!==de["a"].SCENE2D&&this._previousMode!==de["a"].MORPHING&&(this._scene.morphStart.raiseEvent(this,this._previousMode,de["a"].SCENE2D,!0),i._mode=de["a"].MORPHING,i.camera._setTransform(D["a"].IDENTITY),this._previousMode===de["a"].COLUMBUS_VIEW?dt(this,e):bt(this,e,t),0===e&&Object(p["a"])(this._completeMorph)&&this._completeMorph())};var ge=new n["a"],be=new n["a"],Ce=new n["a"],we=new n["a"],Se=new n["a"],Te=new n["a"],De=new n["a"],Ee=new s["a"],ye=new D["a"],Oe=new P["a"],xe=new O["a"],Pe={position:void 0,direction:void 0,up:void 0,position2D:void 0,direction2D:void 0,up2D:void 0,frustum:void 0};ve.prototype.morphToColumbusView=function(e,t){Object(p["a"])(this._completeMorph)&&this._completeMorph();var i=this._scene;if(this._previousMode=i.mode,this._previousMode!==de["a"].COLUMBUS_VIEW&&this._previousMode!==de["a"].MORPHING){this._scene.morphStart.raiseEvent(this,this._previousMode,de["a"].COLUMBUS_VIEW,!0),i.camera._setTransform(D["a"].IDENTITY);var a,r=ge,o=be,s=Ce;if(e>0)r.x=0,r.y=-1,r.z=1,r=n["a"].multiplyByScalar(n["a"].normalize(r,r),5*t.maximumRadius,r),n["a"].negate(n["a"].normalize(r,o),o),n["a"].cross(n["a"].UNIT_X,o,s);else{var u=i.camera;if(this._previousMode===de["a"].SCENE2D)n["a"].clone(u.position,r),r.z=u.frustum.right-u.frustum.left,n["a"].negate(n["a"].UNIT_Z,o),n["a"].clone(n["a"].UNIT_Y,s);else{n["a"].clone(u.positionWC,r),n["a"].clone(u.directionWC,o),n["a"].clone(u.upWC,s);var c=t.scaleToGeodeticSurface(r,De),m=I["a"].eastNorthUpToFixedFrame(c,t,ye);D["a"].inverseTransformation(m,m),i.mapProjection.project(t.cartesianToCartographic(r,Ee),r),D["a"].multiplyByPointAsVector(m,o,o),D["a"].multiplyByPointAsVector(m,s,s)}}this._morphToOrthographic?(a=xe,a.width=i.camera.frustum.right-i.camera.frustum.left,a.aspectRatio=i.drawingBufferWidth/i.drawingBufferHeight):(a=Oe,a.aspectRatio=i.drawingBufferWidth/i.drawingBufferHeight,a.fov=T["a"].toRadians(60));var d=Pe;d.position=r,d.direction=o,d.up=s,d.frustum=a;var h=yt(d);Me(this,h),this._previousMode===de["a"].SCENE2D?wt(this,e,d,h):(d.position2D=D["a"].multiplyByPoint(H["a"].TRANSFORM_2D,r,we),d.direction2D=D["a"].multiplyByPointAsVector(H["a"].TRANSFORM_2D,o,Se),d.up2D=D["a"].multiplyByPointAsVector(H["a"].TRANSFORM_2D,s,Te),i._mode=de["a"].MORPHING,St(this,e,d,h)),0===e&&Object(p["a"])(this._completeMorph)&&this._completeMorph()}};var Re={position:new n["a"],direction:new n["a"],up:new n["a"],frustum:void 0},Fe=new P["a"];function Me(e,t){if(e._scene.completeMorphOnUserInput){e._morphHandler=new le["a"](e._scene.canvas);var i=function(){e._morphCancelled=!0,e._scene.camera.cancelFlight(),t(e)};e._completeMorph=i,e._morphHandler.setInputAction(i,_e["a"].LEFT_DOWN),e._morphHandler.setInputAction(i,_e["a"].MIDDLE_DOWN),e._morphHandler.setInputAction(i,_e["a"].RIGHT_DOWN),e._morphHandler.setInputAction(i,_e["a"].WHEEL)}}function Ie(e){for(var t=e._currentTweens,i=0;i<t.length;++i)t[i].cancelTween();e._currentTweens.length=0,e._morphHandler=e._morphHandler&&e._morphHandler.destroy()}ve.prototype.morphTo3D=function(e,t){Object(p["a"])(this._completeMorph)&&this._completeMorph();var i=this._scene;if(this._previousMode=i.mode,this._previousMode!==de["a"].SCENE3D&&this._previousMode!==de["a"].MORPHING){if(this._scene.morphStart.raiseEvent(this,this._previousMode,de["a"].SCENE3D,!0),i._mode=de["a"].MORPHING,i.camera._setTransform(D["a"].IDENTITY),this._previousMode===de["a"].SCENE2D)Xe(this,e,t);else{var a,r;e>0?(a=Re,n["a"].fromDegrees(0,0,5*t.maximumRadius,t,a.position),n["a"].negate(a.position,a.direction),n["a"].normalize(a.direction,a.direction),n["a"].clone(n["a"].UNIT_Z,a.up)):a=Ae(this,t);var o=i.camera;o.frustum instanceof O["a"]?r=o.frustum.clone():(r=Fe,r.aspectRatio=i.drawingBufferWidth/i.drawingBufferHeight,r.fov=T["a"].toRadians(60)),a.frustum=r;var s=Dt(a);Me(this,s),He(this,e,a,s)}0===e&&Object(p["a"])(this._completeMorph)&&this._completeMorph()}},ve.prototype.isDestroyed=function(){return!1},ve.prototype.destroy=function(){return Ie(this),Object(l["a"])(this)};var je=new s["a"],Ne=new n["a"],Le=new D["a"];function Ae(e,t){var i=e._scene,a=i.camera,r=Re,o=r.position,n=r.direction,s=r.up,u=i.mapProjection.unproject(a.position,je);t.cartographicToCartesian(u,o);var c=t.scaleToGeodeticSurface(o,Ne),m=I["a"].eastNorthUpToFixedFrame(c,t,Le);return D["a"].multiplyByPointAsVector(m,a.direction,n),D["a"].multiplyByPointAsVector(m,a.up,s),r}var Ve=new n["a"],Be=new n["a"],ke=new n["a"],We=new n["a"],Ue=new n["a"],Ge=new n["a"];function He(e,t,i,a){t*=.5;var r=e._scene,o=r.camera,s=n["a"].clone(o.position,Ve),u=n["a"].clone(o.direction,Be),c=n["a"].clone(o.up,ke),m=D["a"].multiplyByPoint(H["a"].TRANSFORM_2D_INVERSE,i.position,We),d=D["a"].multiplyByPointAsVector(H["a"].TRANSFORM_2D_INVERSE,i.direction,Ue),h=D["a"].multiplyByPointAsVector(H["a"].TRANSFORM_2D_INVERSE,i.up,Ge);function p(e){$e(s,m,e.time,o.position),$e(u,d,e.time,o.direction),$e(c,h,e.time,o.up),n["a"].cross(o.direction,o.up,o.right),n["a"].normalize(o.right,o.right)}var f=r.tweens.add({duration:t,easingFunction:pe["a"].QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:p,complete:function(){Tt(e,r,0,1,t,a)}});e._currentTweens.push(f)}var ze=new O["a"],qe=new n["a"],Qe=new n["a"],Ye=new n["a"],Ze=new n["a"],Ke=new n["a"],Je=new n["a"];function Xe(e,t,i){t/=3;var a,r,o=e._scene,s=o.camera;t>0?(a=Re,n["a"].fromDegrees(0,0,5*i.maximumRadius,i,a.position),n["a"].negate(a.position,a.direction),n["a"].normalize(a.direction,a.direction),n["a"].clone(n["a"].UNIT_Z,a.up)):(s.position.z=s.frustum.right-s.frustum.left,a=Ae(e,i)),e._morphToOrthographic?(r=ze,r.aspectRatio=o.drawingBufferWidth/o.drawingBufferHeight,r.width=s.frustum.right-s.frustum.left):(r=Fe,r.aspectRatio=o.drawingBufferWidth/o.drawingBufferHeight,r.fov=T["a"].toRadians(60)),a.frustum=r;var u,c=Dt(a);Me(e,c),u=e._morphToOrthographic?function(){He(e,t,a,c)}:function(){Ct(e,t,a,(function(){He(e,t,a,c)}))},t>0?(o._mode=de["a"].SCENE2D,s.flyTo({duration:t,destination:n["a"].fromDegrees(0,0,5*i.maximumRadius,i,Ze),complete:function(){o._mode=de["a"].MORPHING,u()}})):u()}function $e(e,t,i,a){return n["a"].lerp(e,t,i,a)}function et(e,t,i,a,r){var o=e._scene,n=o.camera;if(!(n.frustum instanceof O["a"])){var s=n.frustum.fov,u=.5*T["a"].RADIANS_PER_DEGREE,c=i.position.z*Math.tan(.5*s);n.frustum.far=c/Math.tan(.5*u)+1e7;var m=o.tweens.add({duration:t,easingFunction:pe["a"].QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:d,complete:function(){n.frustum=i.frustum.clone(),r(e)}});e._currentTweens.push(m)}function d(e){n.frustum.fov=T["a"].lerp(s,u,e.time);var t=c/Math.tan(.5*n.frustum.fov);a(n,t)}}var tt=new n["a"],it=new n["a"],at=new n["a"],rt=new n["a"],ot=new n["a"],nt=new n["a"],st=new x["a"],ut=new fe["a"],ct=new n["a"],mt={position:void 0,direction:void 0,up:void 0,frustum:void 0};function dt(e,t){t*=.5;var i=e._scene,a=i.camera,r=n["a"].clone(a.position,tt),o=n["a"].clone(a.direction,it),s=n["a"].clone(a.up,at),u=n["a"].negate(n["a"].UNIT_Z,ot),c=n["a"].clone(n["a"].UNIT_Y,nt),m=rt;if(t>0)n["a"].clone(n["a"].ZERO,rt),m.z=5*i.mapProjection.ellipsoid.maximumRadius;else{n["a"].clone(r,rt);var d=ut;D["a"].multiplyByPoint(H["a"].TRANSFORM_2D,r,d.origin),D["a"].multiplyByPointAsVector(H["a"].TRANSFORM_2D,o,d.direction);var h=i.globe;if(Object(p["a"])(h)){var f=h.pickWorldCoordinates(d,i,ct);Object(p["a"])(f)&&(D["a"].multiplyByPoint(H["a"].TRANSFORM_2D_INVERSE,f,m),m.z+=n["a"].distance(r,m))}}var l=st;l.right=.5*m.z,l.left=-l.right,l.top=l.right*(i.drawingBufferHeight/i.drawingBufferWidth),l.bottom=-l.top;var _=mt;_.position=m,_.direction=u,_.up=c,_.frustum=l;var v=Et(_);function g(e){$e(r,m,e.time,a.position),$e(o,u,e.time,a.direction),$e(s,c,e.time,a.up),n["a"].cross(a.direction,a.up,a.right),n["a"].normalize(a.right,a.right),a._adjustOrthographicFrustum(!0)}function b(e,t){e.position.z=t}Me(e,v);var C=i.tweens.add({duration:t,easingFunction:pe["a"].QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:g,complete:function(){et(e,t,_,b,v)}});e._currentTweens.push(C)}var ht=new s["a"],pt={position:new n["a"],direction:new n["a"],up:new n["a"],position2D:new n["a"],direction2D:new n["a"],up2D:new n["a"],frustum:new x["a"]},ft={position:new n["a"],direction:new n["a"],up:new n["a"],frustum:void 0},lt=new n["a"],_t=new fe["a"],vt=new D["a"],gt=new n["a"];function bt(e,t,i){t*=.5;var a=e._scene,r=a.camera,o=pt;if(t>0)n["a"].clone(n["a"].ZERO,o.position),o.position.z=5*i.maximumRadius,n["a"].negate(n["a"].UNIT_Z,o.direction),n["a"].clone(n["a"].UNIT_Y,o.up);else{i.cartesianToCartographic(r.positionWC,ht),a.mapProjection.project(ht,o.position),n["a"].negate(n["a"].UNIT_Z,o.direction),n["a"].clone(n["a"].UNIT_Y,o.up);var s=_t;n["a"].clone(o.position2D,s.origin);var u=n["a"].clone(r.directionWC,s.direction),c=i.scaleToGeodeticSurface(r.positionWC,gt),m=I["a"].eastNorthUpToFixedFrame(c,i,vt);D["a"].inverseTransformation(m,m),D["a"].multiplyByPointAsVector(m,u,u),D["a"].multiplyByPointAsVector(H["a"].TRANSFORM_2D,u,u);var d=a.globe;if(Object(p["a"])(d)){var h=d.pickWorldCoordinates(s,a,lt);if(Object(p["a"])(h)){var f=n["a"].distance(o.position2D,h);h.x+=f,n["a"].clone(h,o.position2D)}}}function l(e,t){e.position.x=t}D["a"].multiplyByPoint(H["a"].TRANSFORM_2D,o.position,o.position2D),D["a"].multiplyByPointAsVector(H["a"].TRANSFORM_2D,o.direction,o.direction2D),D["a"].multiplyByPointAsVector(H["a"].TRANSFORM_2D,o.up,o.up2D);var _=o.frustum;_.right=.5*o.position.z,_.left=-_.right,_.top=_.right*(a.drawingBufferHeight/a.drawingBufferWidth),_.bottom=-_.top;var v=ft;D["a"].multiplyByPoint(H["a"].TRANSFORM_2D_INVERSE,o.position2D,v.position),n["a"].clone(o.direction,v.direction),n["a"].clone(o.up,v.up),v.frustum=_;var g=Et(v);function b(){et(e,t,o,l,g)}Me(e,g),St(e,t,o,b)}function Ct(e,t,i,a){var r=e._scene,o=r.camera,n=o.frustum.right-o.frustum.left;o.frustum=i.frustum.clone();var s=o.frustum.fov,u=.5*T["a"].RADIANS_PER_DEGREE,c=n*Math.tan(.5*s);function m(e){o.frustum.fov=T["a"].lerp(u,s,e.time),o.position.z=c/Math.tan(.5*o.frustum.fov)}o.frustum.far=c/Math.tan(.5*u)+1e7,o.frustum.fov=u;var d=r.tweens.add({duration:t,easingFunction:pe["a"].QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:m,complete:function(){a(e)}});e._currentTweens.push(d)}function wt(e,t,i,a){t*=.5;var r=e._scene,o=r.camera,s=n["a"].clone(i.position,Ze),u=n["a"].clone(i.direction,Ke),c=n["a"].clone(i.up,Je);function m(){o.frustum=i.frustum.clone();var m=n["a"].clone(o.position,qe),d=n["a"].clone(o.direction,Qe),h=n["a"].clone(o.up,Ye);function p(e){$e(m,s,e.time,o.position),$e(d,u,e.time,o.direction),$e(h,c,e.time,o.up),n["a"].cross(o.direction,o.up,o.right),n["a"].normalize(o.right,o.right)}m.z=s.z;var f=r.tweens.add({duration:t,easingFunction:pe["a"].QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:p,complete:function(){a(e)}});e._currentTweens.push(f)}r._mode=de["a"].MORPHING,e._morphToOrthographic?m():Ct(e,0,i,m)}function St(e,t,i,a){var r=e._scene,o=r.camera,s=n["a"].clone(o.position,qe),u=n["a"].clone(o.direction,Qe),c=n["a"].clone(o.up,Ye),m=n["a"].clone(i.position2D,Ze),d=n["a"].clone(i.direction2D,Ke),h=n["a"].clone(i.up2D,Je);function p(e){$e(s,m,e.time,o.position),$e(u,d,e.time,o.direction),$e(c,h,e.time,o.up),n["a"].cross(o.direction,o.up,o.right),n["a"].normalize(o.right,o.right),o._adjustOrthographicFrustum(!0)}var f=r.tweens.add({duration:t,easingFunction:pe["a"].QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:p,complete:function(){Tt(e,r,1,0,t,a)}});e._currentTweens.push(f)}function Tt(e,t,i,a,r,o){var n={object:t,property:"morphTime",startValue:i,stopValue:a,duration:r,easingFunction:pe["a"].QUARTIC_OUT};Object(p["a"])(o)&&(n.complete=function(){o(e)});var s=t.tweens.addProperty(n);e._currentTweens.push(s)}function Dt(e){return function(t){var i=t._scene;i._mode=de["a"].SCENE3D,i.morphTime=de["a"].getMorphTime(de["a"].SCENE3D),Ie(t);var a=i.camera;(t._previousMode!==de["a"].MORPHING||t._morphCancelled)&&(t._morphCancelled=!1,n["a"].clone(e.position,a.position),n["a"].clone(e.direction,a.direction),n["a"].clone(e.up,a.up),n["a"].cross(a.direction,a.up,a.right),n["a"].normalize(a.right,a.right),a.frustum=e.frustum.clone());var r=a.frustum;i.frameState.useLogDepth&&(r.near=.1,r.far=1e10);var o=Object(p["a"])(t._completeMorph);t._completeMorph=void 0,i.camera.update(i.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,de["a"].SCENE3D,o)}}function Et(e){return function(t){var i=t._scene;i._mode=de["a"].SCENE2D,i.morphTime=de["a"].getMorphTime(de["a"].SCENE2D),Ie(t);var a=i.camera;n["a"].clone(e.position,a.position),a.position.z=2*i.mapProjection.ellipsoid.maximumRadius,n["a"].clone(e.direction,a.direction),n["a"].clone(e.up,a.up),n["a"].cross(a.direction,a.up,a.right),n["a"].normalize(a.right,a.right),a.frustum=e.frustum.clone();var r=Object(p["a"])(t._completeMorph);t._completeMorph=void 0,i.camera.update(i.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,de["a"].SCENE2D,r)}}function yt(e){return function(t){var i=t._scene;i._mode=de["a"].COLUMBUS_VIEW,i.morphTime=de["a"].getMorphTime(de["a"].COLUMBUS_VIEW),Ie(t);var a=i.camera;(t._previousModeMode!==de["a"].MORPHING||t._morphCancelled)&&(t._morphCancelled=!1,n["a"].clone(e.position,a.position),n["a"].clone(e.direction,a.direction),n["a"].clone(e.up,a.up),n["a"].cross(a.direction,a.up,a.right),n["a"].normalize(a.right,a.right));var r=a.frustum;i.frameState.useLogDepth&&(r.near=.1,r.far=1e10);var o=Object(p["a"])(t._completeMorph);t._completeMorph=void 0,i.camera.update(i.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,de["a"].COLUMBUS_VIEW,o)}}var Ot=ve,xt=i("59d5"),Pt=i("569f"),Rt=i("3626"),Ft=i("cdd6"),Mt=i("619f"),It=i("ef77"),jt=function(e){return function(){e.frameState.afterRender.push((function(){e.requestRender()}))}};function Nt(e){e=Object(h["a"])(e,h["a"].EMPTY_OBJECT);var t=e.canvas,i=e.contextOptions,r=e.creditContainer,o=e.creditViewport,s=Object(p["a"])(r),c=new L["a"](t,i);s||(r=document.createElement("div"),r.style.position="absolute",r.style.bottom="0",r.style["text-shadow"]="0 0 2px #000000",r.style.color="#ffffff",r.style["font-size"]="10px",r.style["padding-right"]="5px",t.parentNode.appendChild(r)),Object(p["a"])(o)||(o=t.parentNode),this._id=Object(m["a"])(),this._jobScheduler=new ie["a"],this._frameState=new $["a"](c,new Q["a"](r," â€¢ ",o),this._jobScheduler),this._frameState.scene3DOnly=Object(h["a"])(e.scene3DOnly,!1),this._removeCreditContainer=!s,this._creditContainer=r,this._canvas=t,this._context=c,this._computeEngine=new N["a"](c),this._globe=void 0,this._primitives=new me["a"],this._groundPrimitives=new me["a"],this._logDepthBuffer=c.fragmentDepth,this._logDepthBufferDirty=!0,this._tweens=new Mt["a"],this._shaderFrameCount=0,this._sunPostProcess=void 0,this._computeCommandList=[],this._overlayCommandList=[],this._useOIT=Object(h["a"])(e.orderIndependentTranslucency,!0),this._executeOITFunction=void 0,this._depthPlane=new Z["a"],this._clearColorCommand=new j["a"]({color:new u["a"],stencil:0,owner:this}),this._depthClearCommand=new j["a"]({depth:1,owner:this}),this._stencilClearCommand=new j["a"]({stencil:0}),this._classificationStencilClearCommand=new j["a"]({stencil:0,renderState:k["a"].fromCache({stencilMask:Rt["a"].CLASSIFICATION_MASK})}),this._depthOnlyRenderStateCache={},this._transitioner=new Ot(this),this._preUpdate=new v["a"],this._postUpdate=new v["a"],this._renderError=new v["a"],this._preRender=new v["a"],this._postRender=new v["a"],this._minimumDisableDepthTestDistance=0,this.rethrowRenderErrors=!1,this.completeMorphOnUserInput=!0,this.morphStart=new v["a"],this.morphComplete=new v["a"],this.skyBox=void 0,this.skyAtmosphere=void 0,this.sun=void 0,this.sunBloom=!0,this._sunBloom=void 0,this.moon=void 0,this.backgroundColor=u["a"].clone(u["a"].BLACK),this._mode=de["a"].SCENE3D,this._mapProjection=Object(p["a"])(e.mapProjection)?e.mapProjection:new g["a"],this.morphTime=1,this.farToNearRatio=1e3,this.logarithmicDepthFarToNearRatio=1e9,this.nearToFarDistance2D=175e4,this.debugCommandFilter=void 0,this.debugShowCommands=!1,this.debugShowFrustums=!1,this.debugShowFramesPerSecond=!1,this.debugShowGlobeDepth=!1,this.debugShowDepthFrustum=1,this.debugShowFrustumPlanes=!1,this._debugShowFrustumPlanes=!1,this._debugFrustumPlanes=void 0,this.useDepthPicking=!0,this.pickTranslucentDepth=!1,this.cameraEventWaitTime=500,this.fog=new X["a"],this._sunCamera=new H["a"](this),this.shadowMap=new Pt["a"]({context:c,lightCamera:this._sunCamera,enabled:Object(h["a"])(e.shadows,!1)}),this.invertClassification=!1,this.invertClassificationColor=u["a"].clone(u["a"].WHITE),this._actualInvertClassificationColor=u["a"].clone(this._invertClassificationColor),this._invertClassification=new te["a"],this.focalLength=void 0,this.eyeSeparation=void 0,this.postProcessStages=new ue["a"],this._brdfLutGenerator=new G["a"],this._terrainExaggeration=Object(h["a"])(e.terrainExaggeration,1),this._performanceDisplay=void 0,this._debugVolume=void 0,this._screenSpaceCameraController=new xt["a"](this),this._mapMode2D=Object(h["a"])(e.mapMode2D,ae["a"].INFINITE_SCROLL),this._environmentState={skyBoxCommand:void 0,skyAtmosphereCommand:void 0,sunDrawCommand:void 0,sunComputeCommand:void 0,moonCommand:void 0,isSunVisible:!1,isMoonVisible:!1,isReadyForAtmosphere:!1,isSkyAtmosphereVisible:!1,clearGlobeDepth:!1,useDepthPlane:!1,renderTranslucentDepthForPick:!1,originalFramebuffer:void 0,useGlobeDepthFramebuffer:!1,separatePrimitiveFramebuffer:!1,useOIT:!1,useInvertClassification:!1,usePostProcess:!1,usePostProcessSelected:!1,useWebVR:!1},this._useWebVR=!1,this._cameraVR=void 0,this._aspectRatioVR=void 0,this.requestRenderMode=Object(h["a"])(e.requestRenderMode,!1),this._renderRequested=!0,this.maximumRenderTimeChange=Object(h["a"])(e.maximumRenderTimeChange,0),this._lastRenderTime=void 0,this._frameRateMonitor=void 0,this._removeRequestListenerCallback=F["a"].requestCompletedEvent.addEventListener(jt(this)),this._removeTaskProcessorListenerCallback=M["a"].taskCompletedEvent.addEventListener(jt(this)),this._removeGlobeCallbacks=[];var d=new a["a"](0,0,c.drawingBufferWidth,c.drawingBufferHeight),f=new H["a"](this);this._logDepthBuffer&&(f.frustum.near=.1,f.frustum.far=1e10),this.preloadFlightCamera=new H["a"](this),this.preloadFlightCullingVolume=void 0,this._picking=new se["a"](this),this._defaultView=new It["a"](this,f,d),this._view=this._defaultView,this._hdr=void 0,this._hdrDirty=void 0,this.highDynamicRange=!1,this.gamma=2.2,this._sunColor=new n["a"](1.8,1.85,2),this.sphericalHarmonicCoefficients=void 0,this.specularEnvironmentMaps=void 0,this._specularEnvironmentMapAtlas=void 0,zt(this,0,S["a"].now()),this.updateFrameState(),this.initializeFrame()}function Lt(e,t){for(var i=0;i<e._removeGlobeCallbacks.length;++i)e._removeGlobeCallbacks[i]();e._removeGlobeCallbacks.length=0;var a=[];Object(p["a"])(t)&&(a.push(t.imageryLayersUpdatedEvent.addEventListener(jt(e))),a.push(t.terrainProviderChanged.addEventListener(jt(e)))),e._removeGlobeCallbacks=a}function At(e,t,i){var a=e._frameState,r=e._context,o=e._view.oit,n=a.shadowState.lightShadowMaps,s=a.shadowState.lightShadowsEnabled,u=t.derivedCommands;Object(p["a"])(t.pickId)&&(u.picking=K["a"].createPickDerivedCommand(e,t,r,u.picking)),t.pickOnly||(u.depth=K["a"].createDepthOnlyDerivedCommand(e,t,r,u.depth)),u.originalCommand=t,e._hdr&&(u.hdr=K["a"].createHdrCommand(t,r,u.hdr),t=u.hdr.command,u=t.derivedCommands),s&&t.receiveShadows&&(u.shadows=Pt["a"].createReceiveDerivedCommand(n,t,i,r,u.shadows)),t.pass===B["a"].TRANSLUCENT&&Object(p["a"])(o)&&o.isSupported()&&(s&&t.receiveShadows?(u.oit=Object(p["a"])(u.oit)?u.oit:{},u.oit.shadows=o.createDerivedCommands(u.shadows.receiveCommand,r,u.oit.shadows)):u.oit=o.createDerivedCommands(t,r,u.oit))}Object(f["a"])(Nt.prototype,{canvas:{get:function(){return this._canvas}},drawingBufferHeight:{get:function(){return this._context.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._context.drawingBufferWidth}},maximumAliasedLineWidth:{get:function(){return A["a"].maximumAliasedLineWidth}},maximumCubeMapSize:{get:function(){return A["a"].maximumCubeMapSize}},pickPositionSupported:{get:function(){return this._context.depthTexture}},sampleHeightSupported:{get:function(){return this._context.depthTexture}},clampToHeightSupported:{get:function(){return this._context.depthTexture}},invertClassificationSupported:{get:function(){return this._context.depthTexture}},specularEnvironmentMapsSupported:{get:function(){return re["a"].isSupported(this._context)}},globe:{get:function(){return this._globe},set:function(e){this._globe=this._globe&&this._globe.destroy(),this._globe=e,Lt(this,e)}},primitives:{get:function(){return this._primitives}},groundPrimitives:{get:function(){return this._groundPrimitives}},camera:{get:function(){return this._view.camera},set:function(e){this._view.camera=e}},view:{get:function(){return this._view},set:function(e){this._view=e}},defaultView:{get:function(){return this._defaultView}},picking:{get:function(){return this._picking}},screenSpaceCameraController:{get:function(){return this._screenSpaceCameraController}},mapProjection:{get:function(){return this._mapProjection}},jobScheduler:{get:function(){return this._jobScheduler}},frameState:{get:function(){return this._frameState}},environmentState:{get:function(){return this._environmentState}},tweens:{get:function(){return this._tweens}},imageryLayers:{get:function(){if(Object(p["a"])(this.globe))return this.globe.imageryLayers}},terrainProvider:{get:function(){if(Object(p["a"])(this.globe))return this.globe.terrainProvider},set:function(e){Object(p["a"])(this.globe)&&(this.globe.terrainProvider=e)}},terrainProviderChanged:{get:function(){if(Object(p["a"])(this.globe))return this.globe.terrainProviderChanged}},preUpdate:{get:function(){return this._preUpdate}},postUpdate:{get:function(){return this._postUpdate}},renderError:{get:function(){return this._renderError}},preRender:{get:function(){return this._preRender}},postRender:{get:function(){return this._postRender}},lastRenderTime:{get:function(){return this._lastRenderTime}},context:{get:function(){return this._context}},debugFrustumStatistics:{get:function(){return this._view.debugFrustumStatistics}},scene3DOnly:{get:function(){return this._frameState.scene3DOnly}},orderIndependentTranslucency:{get:function(){return this._useOIT}},id:{get:function(){return this._id}},mode:{get:function(){return this._mode},set:function(e){e===de["a"].SCENE2D?this.morphTo2D(0):e===de["a"].SCENE3D?this.morphTo3D(0):e===de["a"].COLUMBUS_VIEW&&this.morphToColumbusView(0),this._mode=e}},frustumCommandsList:{get:function(){return this._view.frustumCommandsList}},numberOfFrustums:{get:function(){return this._view.frustumCommandsList.length}},terrainExaggeration:{get:function(){return this._terrainExaggeration}},useWebVR:{get:function(){return this._useWebVR},set:function(e){this._useWebVR=e,this._useWebVR?(this._frameState.creditDisplay.container.style.visibility="hidden",this._cameraVR=new H["a"](this),Object(p["a"])(this._deviceOrientationCameraController)||(this._deviceOrientationCameraController=new J["a"](this)),this._aspectRatioVR=this.camera.frustum.aspectRatio):(this._frameState.creditDisplay.container.style.visibility="visible",this._cameraVR=void 0,this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this.camera.frustum.aspectRatio=this._aspectRatioVR,this.camera.frustum.xOffset=0)}},mapMode2D:{get:function(){return this._mapMode2D}},imagerySplitPosition:{get:function(){return this._frameState.imagerySplitPosition},set:function(e){this._frameState.imagerySplitPosition=e}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance},set:function(e){this._minimumDisableDepthTestDistance=e}},logarithmicDepthBuffer:{get:function(){return this._logDepthBuffer},set:function(e){e=this._context.fragmentDepth&&e,this._logDepthBuffer!==e&&(this._logDepthBuffer=e,this._logDepthBufferDirty=!0,this._defaultView.updateFrustums=!0)}},gamma:{get:function(){return this._context.uniformState.gamma},set:function(e){this._context.uniformState.gamma=e}},highDynamicRange:{get:function(){return this._hdr},set:function(e){var t=this._context,i=e&&t.depthTexture&&(t.colorBufferFloat||t.colorBufferHalfFloat);this._hdrDirty=i!==this._hdr,this._hdr=i}},highDynamicRangeSupported:{get:function(){var e=this._context;return e.depthTexture&&(e.colorBufferFloat||e.colorBufferHalfFloat)}},sunColor:{get:function(){return this._sunColor},set:function(e){this._sunColor=e}},pixelRatio:{get:function(){return this._frameState.pixelRatio},set:function(e){this._frameState.pixelRatio=e}},opaqueFrustumNearOffset:{get:function(){return this._frameState.useLogDepth?.9:.9999}}}),Nt.prototype.getCompressedTextureFormatSupported=function(e){var t=this.context;return("WEBGL_compressed_texture_s3tc"===e||"s3tc"===e)&&t.s3tc||("WEBGL_compressed_texture_pvrtc"===e||"pvrtc"===e)&&t.pvrtc||("WEBGL_compressed_texture_etc1"===e||"etc1"===e)&&t.etc1},Nt.prototype.updateDerivedCommands=function(e){if(Object(p["a"])(e.derivedCommands)){var t=this._frameState,i=this._context,a=!1,r=t.shadowState.lastDirtyTime;e.lastDirtyTime!==r&&(e.lastDirtyTime=r,e.dirty=!0,a=!0);var o=t.useLogDepth,n=this._hdr,s=e.derivedCommands,u=Object(p["a"])(s.logDepth),c=Object(p["a"])(s.hdr),m=Object(p["a"])(s.originalCommand),d=o&&!u,h=n&&!c,f=(!o||!n)&&!m;if(e.dirty=e.dirty||d||h||f,e.dirty){e.dirty=!1;var l=t.shadowState.shadowMaps,_=t.shadowState.shadowsEnabled;_&&e.castShadows&&(s.shadows=Pt["a"].createCastDerivedCommand(l,e,a,i,s.shadows)),(u||d)&&(s.logDepth=K["a"].createLogDepthCommand(e,i,s.logDepth),At(this,s.logDepth.command,a)),(m||f)&&At(this,e,a)}}};var Vt,Bt=new q["a"]({pass:z["a"].RENDER}),kt=new q["a"]({pass:z["a"].PRELOAD}),Wt=new q["a"]({pass:z["a"].PRELOAD_FLIGHT}),Ut=new q["a"]({pass:z["a"].REQUEST_RENDER_MODE_DEFER_CHECK}),Gt=new r["a"];function Ht(e){var t=e.globe;if(e._mode===de["a"].SCENE3D&&Object(p["a"])(t)&&t.show){var i=t.ellipsoid;return Gt.radius=i.minimumRadius,Vt=y["a"].fromBoundingSphere(Gt,e.camera.positionWC,Vt),Vt}}function zt(e,t,i){var a=e._frameState;a.frameNumber=t,a.time=S["a"].clone(i,a.time)}function qt(e){var t={},i=e.vertexAttributes;for(var a in i)i.hasOwnProperty(a)&&(t[a]=i[a].index);return t}function Qt(e,t,i){var a=t.context,r=Object(h["a"])(i,e.shaderProgram),o=r.fragmentShaderSource.clone(),n=[];o.sources=o.sources.map((function(e){e=U["a"].replaceMain(e,"czm_Debug_main");var t,i=/gl_FragData\[(\d+)\]/g;while(null!==(t=i.exec(e)))-1===n.indexOf(t[1])&&n.push(t[1]);return e}));var s,c=n.length,m="void main() \n{ \n    czm_Debug_main(); \n";if(t.debugShowCommands){Object(p["a"])(e._debugColor)||(e._debugColor=u["a"].fromRandom());var d=e._debugColor;if(c>0)for(s=0;s<c;++s)m+="    gl_FragData["+n[s]+"].rgb *= vec3("+d.red+", "+d.green+", "+d.blue+"); \n";else m+="    gl_FragColor.rgb *= vec3("+d.red+", "+d.green+", "+d.blue+"); \n"}if(t.debugShowFrustums){var f=1&e.debugOverlappingFrustums?"1.0":"0.0",l=2&e.debugOverlappingFrustums?"1.0":"0.0",_=4&e.debugOverlappingFrustums?"1.0":"0.0";if(c>0)for(s=0;s<c;++s)m+="    gl_FragData["+n[s]+"].rgb *= vec3("+f+", "+l+", "+_+"); \n";else m+="    gl_FragColor.rgb *= vec3("+f+", "+l+", "+_+"); \n"}m+="}",o.sources.push(m);var v=qt(r);return W["a"].fromCache({context:a,vertexShaderSource:r.vertexShaderSource,fragmentShaderSource:o,attributeLocations:v})}function Yt(e,t,i){var a=V["a"].shallowClone(e);a.shaderProgram=Qt(e,t),a.execute(t.context,i),a.shaderProgram.destroy()}Nt.prototype.clearPasses=function(e){e.render=!1,e.pick=!1,e.depth=!1,e.postProcess=!1,e.offscreen=!1},Nt.prototype.updateFrameState=function(){var e=this.camera,t=this._frameState;t.commandList.length=0,t.shadowMaps.length=0,t.brdfLutGenerator=this._brdfLutGenerator,t.environmentMap=this.skyBox&&this.skyBox._cubeMap,t.mode=this._mode,t.morphTime=this.morphTime,t.mapProjection=this.mapProjection,t.camera=e,t.cullingVolume=e.frustum.computeCullingVolume(e.positionWC,e.directionWC,e.upWC),t.occluder=Ht(this),t.terrainExaggeration=this._terrainExaggeration,t.minimumDisableDepthTestDistance=this._minimumDisableDepthTestDistance,t.invertClassification=this.invertClassification,t.useLogDepth=this._logDepthBuffer&&!(this.camera.frustum instanceof O["a"]||this.camera.frustum instanceof x["a"]),t.sunColor=this._sunColor,Object(p["a"])(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.ready?(t.specularEnvironmentMaps=this._specularEnvironmentMapAtlas.texture,t.specularEnvironmentMapsMaximumLOD=this._specularEnvironmentMapAtlas.maximumMipmapLevel):(t.specularEnvironmentMaps=void 0,t.specularEnvironmentMapsMaximumLOD=void 0),t.sphericalHarmonicCoefficients=this.sphericalHarmonicCoefficients,this._actualInvertClassificationColor=u["a"].clone(this.invertClassificationColor,this._actualInvertClassificationColor),te["a"].isTranslucencySupported(this._context)||(this._actualInvertClassificationColor.alpha=1),t.invertClassificationColor=this._actualInvertClassificationColor,Object(p["a"])(this.globe)?t.maximumScreenSpaceError=this.globe.maximumScreenSpaceError:t.maximumScreenSpaceError=2,this.clearPasses(t.passes),t.tilesetPassState=void 0},Nt.prototype.isVisible=function(e,t,i){return Object(p["a"])(e)&&(!Object(p["a"])(e.boundingVolume)||!e.cull||t.computeVisibility(e.boundingVolume)!==w["a"].OUTSIDE&&(!Object(p["a"])(i)||!e.occlude||!e.boundingVolume.isOccluded(i)))};var Zt=new D["a"](0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1);function Kt(e,t,i,a){var r,s=t._frameState,u=s.context,m=e.boundingVolume;Object(p["a"])(t._debugVolume)&&t._debugVolume.destroy();var d=n["a"].clone(m.center);if(s.mode!==de["a"].SCENE3D){d=D["a"].multiplyByPoint(Zt,d,d);var h=s.mapProjection,f=h.unproject(d);d=h.ellipsoid.cartographicToCartesian(f)}if(Object(p["a"])(m.radius)){var l=m.radius;r=C["a"].toWireframe(_["a"].createGeometry(new _["a"]({radii:new n["a"](l,l,l),vertexFormat:ne["a"].FLAT_VERTEX_FORMAT}))),t._debugVolume=new ce["a"]({geometryInstances:new b["a"]({geometry:r,modelMatrix:D["a"].fromTranslation(d),attributes:{color:new c["a"](1,0,0,1)}}),appearance:new ne["a"]({flat:!0,translucent:!1}),asynchronous:!1})}else{var v=m.halfAxes;r=C["a"].toWireframe(o["a"].createGeometry(o["a"].fromDimensions({dimensions:new n["a"](2,2,2),vertexFormat:ne["a"].FLAT_VERTEX_FORMAT}))),t._debugVolume=new ce["a"]({geometryInstances:new b["a"]({geometry:r,modelMatrix:D["a"].fromRotationTranslation(v,d,new D["a"]),attributes:{color:new c["a"](1,0,0,1)}}),appearance:new ne["a"]({flat:!0,translucent:!1}),asynchronous:!1})}var g,w=s.commandList,S=s.commandList=[];if(t._debugVolume.update(s),e=S[0],s.useLogDepth){var T=K["a"].createLogDepthCommand(e,u);e=T.command}Object(p["a"])(a)&&(g=i.framebuffer,i.framebuffer=a),e.execute(u,i),Object(p["a"])(g)&&(i.framebuffer=g),s.commandList=w}function Jt(e,t,i,a,r){var o=t._frameState;if(!Object(p["a"])(t.debugCommandFilter)||t.debugCommandFilter(e))if(e instanceof j["a"])e.execute(i,a);else{e.debugShowBoundingVolume&&Object(p["a"])(e.boundingVolume)&&Kt(e,t,a,r),o.useLogDepth&&Object(p["a"])(e.derivedCommands.logDepth)&&(e=e.derivedCommands.logDepth.command);var n=o.passes;if(!n.pick&&t._hdr&&Object(p["a"])(e.derivedCommands)&&Object(p["a"])(e.derivedCommands.hdr)&&(e=e.derivedCommands.hdr.command),n.pick||n.depth){if(n.pick&&!n.depth&&Object(p["a"])(e.derivedCommands.picking))return e=e.derivedCommands.picking.pickCommand,void e.execute(i,a);if(Object(p["a"])(e.derivedCommands.depth))return e=e.derivedCommands.depth.depthOnlyCommand,void e.execute(i,a)}t.debugShowCommands||t.debugShowFrustums?Yt(e,t,a):o.shadowState.lightShadowsEnabled&&e.receiveShadows&&Object(p["a"])(e.derivedCommands.shadows)?e.derivedCommands.shadows.receiveCommand.execute(i,a):e.execute(i,a)}}function Xt(e,t,i,a){var r=t._frameState,o=e.derivedCommands;Object(p["a"])(o)&&(r.useLogDepth&&Object(p["a"])(o.logDepth)&&(e=o.logDepth.command),o=e.derivedCommands,Object(p["a"])(o.picking)?(e=o.picking.pickCommand,e.execute(i,a)):Object(p["a"])(o.depth)&&(e=o.depth.depthOnlyCommand,e.execute(i,a)))}function $t(e,t,i){return t.boundingVolume.distanceSquaredTo(i)-e.boundingVolume.distanceSquaredTo(i)}function ei(e,t,i){return e.boundingVolume.distanceSquaredTo(i)-t.boundingVolume.distanceSquaredTo(i)+T["a"].EPSILON12}function ti(e,t,i,a,r){var o=e.context;Object(E["a"])(a,$t,e.camera.positionWC),Object(p["a"])(r)&&t(r.unclassifiedCommand,e,o,i);for(var n=a.length,s=0;s<n;++s)t(a[s],e,o,i)}function ii(e,t,i,a,r){var o=e.context;Object(E["a"])(a,ei,e.camera.positionWC),Object(p["a"])(r)&&t(r.unclassifiedCommand,e,o,i);for(var n=a.length,s=0;s<n;++s)t(a[s],e,o,i)}function ai(e,t){var i=e._view.debugGlobeDepths,a=i[t];return!Object(p["a"])(a)&&e.context.depthTexture&&(a=new ee["a"],i[t]=a),a}Zt=D["a"].inverseTransformation(Zt,Zt);var ri=new P["a"],oi=new R["a"],ni=new O["a"],si=new x["a"];function ui(e,t){var i,a=e.camera,r=e.context,o=r.uniformState;o.updateCamera(a),i=Object(p["a"])(a.frustum.fov)?a.frustum.clone(ri):Object(p["a"])(a.frustum.infiniteProjectionMatrix)?a.frustum.clone(oi):Object(p["a"])(a.frustum.width)?a.frustum.clone(ni):a.frustum.clone(si),i.near=a.frustum.near,i.far=a.frustum.far,o.updateFrustum(i),o.updatePass(B["a"].ENVIRONMENT);var n,s=e._frameState.passes,u=s.pick,c=e._environmentState,m=e._view,d=c.renderTranslucentDepthForPick,h=c.useWebVR;if(!u){var f,l=c.skyBoxCommand;if(Object(p["a"])(l)&&Jt(l,e,r,t),c.isSkyAtmosphereVisible&&Jt(c.skyAtmosphereCommand,e,r,t),c.isSunVisible)if(c.sunDrawCommand.execute(r,t),e.sunBloom&&!h)f=c.useGlobeDepthFramebuffer?m.globeDepth.framebuffer:c.usePostProcess?m.sceneFramebuffer.getFramebuffer():c.originalFramebuffer,e._sunPostProcess.execute(r),e._sunPostProcess.copy(r,f),t.framebuffer=f;c.isMoonVisible&&c.moonCommand.execute(r,t)}c.useOIT?(Object(p["a"])(e._executeOITFunction)||(e._executeOITFunction=function(e,t,i,a,r){m.oit.executeCommands(e,t,i,a,r)}),n=e._executeOITFunction):n=s.render?ti:ii;for(var _,v=m.frustumCommandsList,g=v.length,b=c.clearGlobeDepth,C=c.useDepthPlane,w=c.separatePrimitiveFramebuffer=!1,S=e._depthClearCommand,T=e._stencilClearCommand,D=e._classificationStencilClearCommand,E=e._depthPlane,y=c.usePostProcessSelected,O=a.position.z,x=0;x<g;++x){var P=g-x-1,R=v[P];e.mode===de["a"].SCENE2D?(a.position.z=O-R.near+1,i.far=Math.max(1,R.far-R.near),i.near=1,o.update(e.frameState),o.updateFrustum(i)):(i.near=0!==P?R.near*e.opaqueFrustumNearOffset:R.near,i.far=R.far,o.updateFrustum(i));var F,M=e.debugShowGlobeDepth?ai(e,P):m.globeDepth;w&&(t.framebuffer=M.framebuffer),e.debugShowGlobeDepth&&Object(p["a"])(M)&&c.useGlobeDepthFramebuffer&&(M.update(r,t,m.viewport,e._hdr,b),M.clear(r,t,e._clearColorCommand.color),F=t.framebuffer,t.framebuffer=M.framebuffer),S.execute(r,t),r.stencilBuffer&&T.execute(r,t),o.updatePass(B["a"].GLOBE);var I,j=R.commands[B["a"].GLOBE],N=R.indices[B["a"].GLOBE];for(_=0;_<N;++_)Jt(j[_],e,r,t);for(Object(p["a"])(M)&&c.useGlobeDepthFramebuffer&&M.executeCopyDepth(r,t),e.debugShowGlobeDepth&&Object(p["a"])(M)&&c.useGlobeDepthFramebuffer&&(t.framebuffer=F),o.updatePass(B["a"].TERRAIN_CLASSIFICATION),j=R.commands[B["a"].TERRAIN_CLASSIFICATION],N=R.indices[B["a"].TERRAIN_CLASSIFICATION],_=0;_<N;++_)Jt(j[_],e,r,t);if(b&&(S.execute(r,t),C&&E.execute(r,t)),w&&(t.framebuffer=M.primitiveFramebuffer),!c.useInvertClassification||u){for(o.updatePass(B["a"].CESIUM_3D_TILE),j=R.commands[B["a"].CESIUM_3D_TILE],N=R.indices[B["a"].CESIUM_3D_TILE],_=0;_<N;++_)Jt(j[_],e,r,t);if(N>0)for(Object(p["a"])(M)&&c.useGlobeDepthFramebuffer&&M.executeUpdateDepth(r,t,b),o.updatePass(B["a"].CESIUM_3D_TILE_CLASSIFICATION),j=R.commands[B["a"].CESIUM_3D_TILE_CLASSIFICATION],N=R.indices[B["a"].CESIUM_3D_TILE_CLASSIFICATION],_=0;_<N;++_)Jt(j[_],e,r,t)}else{e._invertClassification.clear(r,t);var L=t.framebuffer;for(t.framebuffer=e._invertClassification._fbo,o.updatePass(B["a"].CESIUM_3D_TILE),j=R.commands[B["a"].CESIUM_3D_TILE],N=R.indices[B["a"].CESIUM_3D_TILE],_=0;_<N;++_)Jt(j[_],e,r,t);for(Object(p["a"])(M)&&c.useGlobeDepthFramebuffer&&M.executeUpdateDepth(r,t,b),o.updatePass(B["a"].CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW),j=R.commands[B["a"].CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],N=R.indices[B["a"].CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],_=0;_<N;++_)Jt(j[_],e,r,t);for(t.framebuffer=L,e._invertClassification.executeClassified(r,t),1===e.frameState.invertClassificationColor.alpha&&e._invertClassification.executeUnclassified(r,t),N>0&&r.stencilBuffer&&D.execute(r,t),o.updatePass(B["a"].CESIUM_3D_TILE_CLASSIFICATION),j=R.commands[B["a"].CESIUM_3D_TILE_CLASSIFICATION],N=R.indices[B["a"].CESIUM_3D_TILE_CLASSIFICATION],_=0;_<N;++_)Jt(j[_],e,r,t)}for(N>0&&r.stencilBuffer&&T.execute(r,t),o.updatePass(B["a"].OPAQUE),j=R.commands[B["a"].OPAQUE],N=R.indices[B["a"].OPAQUE],_=0;_<N;++_)Jt(j[_],e,r,t);if(0!==P&&e.mode!==de["a"].SCENE2D&&(i.near=R.near,o.updateFrustum(i)),!u&&c.useInvertClassification&&e.frameState.invertClassificationColor.alpha<1&&(I=e._invertClassification),o.updatePass(B["a"].TRANSLUCENT),j=R.commands[B["a"].TRANSLUCENT],j.length=R.indices[B["a"].TRANSLUCENT],n(e,Jt,t,j,I),r.depthTexture&&e.useDepthPicking&&(c.useGlobeDepthFramebuffer||d)){var A=d?t.framebuffer.depthStencilTexture:M.framebuffer.depthStencilTexture,V=e._picking.getPickDepth(e,P);V.update(r,A),V.executeCopyDepth(r,t)}if(w&&(t.framebuffer=M.framebuffer),!u&&y){var k=t.framebuffer;for(t.framebuffer=m.sceneFramebuffer.getIdFramebuffer(),i.near=0!==P?R.near*e.opaqueFrustumNearOffset:R.near,i.far=R.far,o.updateFrustum(i),o.updatePass(B["a"].GLOBE),j=R.commands[B["a"].GLOBE],N=R.indices[B["a"].GLOBE],_=0;_<N;++_)Xt(j[_],e,r,t);for(b&&(S.framebuffer=t.framebuffer,S.execute(r,t),S.framebuffer=void 0),b&&C&&E.execute(r,t),o.updatePass(B["a"].CESIUM_3D_TILE),j=R.commands[B["a"].CESIUM_3D_TILE],N=R.indices[B["a"].CESIUM_3D_TILE],_=0;_<N;++_)Xt(j[_],e,r,t);for(o.updatePass(B["a"].OPAQUE),j=R.commands[B["a"].OPAQUE],N=R.indices[B["a"].OPAQUE],_=0;_<N;++_)Xt(j[_],e,r,t);for(o.updatePass(B["a"].TRANSLUCENT),j=R.commands[B["a"].TRANSLUCENT],N=R.indices[B["a"].TRANSLUCENT],_=0;_<N;++_)Xt(j[_],e,r,t);t.framebuffer=k}}}function ci(e){var t=e.context.uniformState;t.updatePass(B["a"].COMPUTE);var i=e._environmentState.sunComputeCommand;Object(p["a"])(i)&&i.execute(e._computeEngine);for(var a=e._computeCommandList,r=a.length,o=0;o<r;++o)a[o].execute(e._computeEngine)}function mi(e,t){var i=e.context.uniformState;i.updatePass(B["a"].OVERLAY);for(var a=e.context,r=e._overlayCommandList,o=r.length,n=0;n<o;++n)r[n].execute(a,t)}function di(e,t,i){for(var a=i.shadowMapCullingVolume,r=i.isPointLight,o=i.passes,n=o.length,s=t.length,u=0;u<s;++u){var c=t[u];if(e.updateDerivedCommands(c),c.castShadows&&(c.pass===B["a"].GLOBE||c.pass===B["a"].CESIUM_3D_TILE||c.pass===B["a"].OPAQUE||c.pass===B["a"].TRANSLUCENT)&&e.isVisible(c,a))if(r)for(var m=0;m<n;++m)o[m].commandList.push(c);else if(1===n)o[0].commandList.push(c);else for(var d=!1,h=n-1;h>=0;--h){var p=o[h].cullingVolume;if(e.isVisible(c,p))o[h].commandList.push(c),d=!0;else if(d)break}}}function hi(e){var t=e.frameState,i=t.shadowState.shadowMaps,a=i.length;if(t.shadowState.shadowsEnabled)for(var r=e.context,o=r.uniformState,n=0;n<a;++n){var s=i[n];if(!s.outOfView){var u,c=s.passes,m=c.length;for(u=0;u<m;++u)c[u].commandList.length=0;var d=e.frameState.commandList;for(di(e,d,s),u=0;u<m;++u){var h=s.passes[u];o.updateCamera(h.camera),s.updatePass(r,u);for(var p=h.commandList.length,f=0;f<p;++f){var l=h.commandList[f];o.updatePass(l.pass),Jt(l.derivedCommands.shadows.castCommands[n],e,r,h.passState)}}}}}var pi=new n["a"];function fi(e,t,i){var a=e._view,r=a.camera,o=e._environmentState,s=o.renderTranslucentDepthForPick;Pi(e,t,i),s||xi(e),a.createPotentiallyVisibleSet(e),s||(ci(e),hi(e));var u=t.viewport;u.x=0,u.y=0,u.width=.5*u.width;var c=H["a"].clone(r,e._cameraVR);c.frustum=r.frustum;var m=r.frustum.near,d=m*Object(h["a"])(e.focalLength,5),p=Object(h["a"])(e.eyeSeparation,d/30),f=n["a"].multiplyByScalar(c.right,.5*p,pi);r.frustum.aspectRatio=u.width/u.height;var l=.5*p*m/d;n["a"].add(c.position,f,r.position),r.frustum.xOffset=l,ui(e,t),u.x=u.width,n["a"].subtract(c.position,f,r.position),r.frustum.xOffset=-l,ui(e,t),H["a"].clone(c,r)}Nt.prototype.updateAndExecuteCommands=function(e,t){var i=this._frameState,a=i.mode,r=this._environmentState.useWebVR;r?fi(this,e,t):a!==de["a"].SCENE2D||this._mapMode2D===ae["a"].ROTATE?Di(!0,this,e,t):(Pi(this,e,t),Ti(this,e))};var li=new s["a"](Math.PI,T["a"].PI_OVER_TWO),_i=new n["a"],vi=new n["a"],gi=new D["a"],bi=new D["a"],Ci=new n["a"],wi=new n["a"],Si=new a["a"];function Ti(e,t){var i=e.context,r=e.frameState,o=e.camera,s=t.viewport,u=a["a"].clone(s,Si);t.viewport=u;var c=li,m=_i,d=e.mapProjection;d.project(c,m);var h=n["a"].clone(o.position,vi),p=D["a"].clone(o.transform,bi),f=o.frustum.clone();o._setTransform(D["a"].IDENTITY);var l=D["a"].computeViewportTransformation(u,0,1,gi),_=o.frustum.projectionMatrix,v=o.positionWC.y,g=n["a"].fromElements(T["a"].sign(v)*m.x-v,0,-o.positionWC.x,Ci),b=I["a"].pointToGLWindowCoordinates(_,l,g,wi);b.x=Math.floor(b.x);var C=u.x,w=u.width;if(0===v||b.x<=C||b.x>=C+w)Di(!0,e,t);else if(Math.abs(C+.5*w-b.x)<1)u.width=b.x-u.x,o.position.x*=T["a"].sign(o.position.x),o.frustum.right=0,r.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(r),Di(!0,e,t),u.x=b.x,o.position.x=-o.position.x,o.frustum.right=-o.frustum.left,o.frustum.left=0,r.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(r),Di(!1,e,t);else if(b.x>C+.5*w){u.width=b.x-C;var S=o.frustum.right;o.frustum.right=m.x-v,r.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(r),Di(!0,e,t),u.x=b.x,u.width=C+w-b.x,o.position.x=-o.position.x,o.frustum.left=-o.frustum.right,o.frustum.right=S-2*o.frustum.right,r.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(r),Di(!1,e,t)}else{u.x=b.x,u.width=C+w-b.x;var E=o.frustum.left;o.frustum.left=-m.x-v,r.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(r),Di(!0,e,t),u.x=C,u.width=b.x-C,o.position.x=-o.position.x,o.frustum.right=-o.frustum.left,o.frustum.left=E-2*o.frustum.left,r.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(r),Di(!1,e,t)}o._setTransform(p),n["a"].clone(h,o.position),o.frustum=f.clone(),t.viewport=s}function Di(e,t,i,a){var r=t._environmentState,o=t._view,n=r.renderTranslucentDepthForPick;e||n||(t.frameState.commandList.length=0),n||xi(t),o.createPotentiallyVisibleSet(t),e&&(Object(p["a"])(a)&&Pi(t,i,a),n||(ci(t),hi(t))),ui(t,i)}var Ei=new d["a"];function yi(e){var t=e._frameState;e.debugShowFrustumPlanes!==e._debugShowFrustumPlanes&&(e.debugShowFrustumPlanes?e._debugFrustumPlanes=new Y["a"]({camera:e.camera,updateOnChange:!1}):e._debugFrustumPlanes=e._debugFrustumPlanes&&e._debugFrustumPlanes.destroy(),e._debugShowFrustumPlanes=e.debugShowFrustumPlanes),Object(p["a"])(e._debugFrustumPlanes)&&e._debugFrustumPlanes.update(t)}function Oi(e){var t=e._frameState,i=t.shadowMaps,a=i.length,r=a>0&&!t.passes.pick&&e.mode===de["a"].SCENE3D;if(r!==t.shadowState.shadowsEnabled&&(++t.shadowState.lastDirtyTime,t.shadowState.shadowsEnabled=r),t.shadowState.lightShadowsEnabled=!1,r){for(var o=0;o<a;++o)if(i[o]!==t.shadowState.shadowMaps[o]){++t.shadowState.lastDirtyTime;break}t.shadowState.shadowMaps.length=0,t.shadowState.lightShadowMaps.length=0;for(var n=0;n<a;++n){var s=i[n];s.update(t),t.shadowState.shadowMaps.push(s),s.fromLightSource&&(t.shadowState.lightShadowMaps.push(s),t.shadowState.lightShadowsEnabled=!0),s.dirty&&(++t.shadowState.lastDirtyTime,s.dirty=!1)}}}function xi(e){var t=e._frameState;e._groundPrimitives.update(t),e._primitives.update(t),yi(e),Oi(e),e._globe&&e._globe.render(t)}function Pi(e,t,i){var a=e._context,r=e._frameState,o=e._environmentState,n=e._view,s=e._frameState.passes,c=s.pick,m=o.useWebVR;o.originalFramebuffer=t.framebuffer,Object(p["a"])(e.sun)&&e.sunBloom!==e._sunBloom?(e.sunBloom&&!m?e._sunPostProcess=new Ft["a"]:Object(p["a"])(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy()),e._sunBloom=e.sunBloom):!Object(p["a"])(e.sun)&&Object(p["a"])(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy(),e._sunBloom=!1);var d=e._clearColorCommand;u["a"].clone(i,d.color),d.execute(a,t);var h=o.useGlobeDepthFramebuffer=Object(p["a"])(n.globeDepth);h&&(n.globeDepth.update(a,t,n.viewport,e._hdr,o.clearGlobeDepth),n.globeDepth.clear(a,t,i));var f=n.oit,l=o.useOIT=!c&&Object(p["a"])(f)&&f.isSupported();l&&(f.update(a,t,n.globeDepth.framebuffer,e._hdr),f.clear(a,t,i),o.useOIT=f.isSupported());var _=e.postProcessStages,v=o.usePostProcess=!c&&(e._hdr||_.length>0||_.ambientOcclusion.enabled||_.fxaa.enabled||_.bloom.enabled);o.usePostProcessSelected=!1,v&&(n.sceneFramebuffer.update(a,n.viewport,e._hdr),n.sceneFramebuffer.clear(a,t,i),_.update(a,r.useLogDepth,e._hdr),_.clear(a),v=o.usePostProcess=_.ready,o.usePostProcessSelected=v&&_.hasSelected),o.isSunVisible&&e.sunBloom&&!m?(t.framebuffer=e._sunPostProcess.update(t),e._sunPostProcess.clear(a,t,i)):h?t.framebuffer=n.globeDepth.framebuffer:v&&(t.framebuffer=n.sceneFramebuffer.getFramebuffer()),Object(p["a"])(t.framebuffer)&&d.execute(a,t);var g,b=o.useInvertClassification=!c&&Object(p["a"])(t.framebuffer)&&e.invertClassification;if(b)if(1===e.frameState.invertClassificationColor.alpha&&o.useGlobeDepthFramebuffer&&(g=n.globeDepth.framebuffer),Object(p["a"])(g)||a.depthTexture){if(e._invertClassification.previousFramebuffer=g,e._invertClassification.update(a),e._invertClassification.clear(a,t),e.frameState.invertClassificationColor.alpha<1&&l){var C=e._invertClassification.unclassifiedCommand,w=C.derivedCommands;w.oit=f.createDerivedCommands(C,a,w.oit)}}else o.useInvertClassification=!1}function Ri(e){for(var t=e._frameState.afterRender,i=0,a=t.length;i<a;++i)t[i](),e.requestRender();t.length=0}function Fi(e,t){if(e.debugShowFramesPerSecond){if(!Object(p["a"])(e._performanceDisplay)){var i=document.createElement("div");i.className="cesium-performanceDisplay-defaultContainer";var a=e._canvas.parentNode;a.appendChild(i);var r=new oe["a"]({container:i});e._performanceDisplay=r,e._performanceContainer=i}e._performanceDisplay.throttled=e.requestRenderMode,e._performanceDisplay.update(t)}else Object(p["a"])(e._performanceDisplay)&&(e._performanceDisplay=e._performanceDisplay&&e._performanceDisplay.destroy(),e._performanceContainer.parentNode.removeChild(e._performanceContainer))}function Mi(e){e._jobScheduler.resetBudgets();var t=e._frameState,i=e.primitives;i.prePassesUpdate(t),Object(p["a"])(e.globe)&&e.globe.update(t),e._picking.update(),t.creditDisplay.update()}function Ii(e){var t=e._frameState,i=e.primitives;i.postPassesUpdate(t),F["a"].update()}Nt.prototype.updateEnvironment=function(){var e=this._frameState,t=this._view,i=this._environmentState,a=e.passes.render,r=e.passes.offscreen,o=this.skyAtmosphere,n=this.globe;if(!a||this._mode!==de["a"].SCENE2D&&t.camera.frustum instanceof O["a"])i.skyAtmosphereCommand=void 0,i.skyBoxCommand=void 0,i.sunDrawCommand=void 0,i.sunComputeCommand=void 0,i.moonCommand=void 0;else{Object(p["a"])(o)&&Object(p["a"])(n)&&(o.setDynamicAtmosphereColor(n.enableLighting),i.isReadyForAtmosphere=i.isReadyForAtmosphere||n._surface._tilesToRender.length>0),i.skyAtmosphereCommand=Object(p["a"])(o)?o.update(e):void 0,i.skyBoxCommand=Object(p["a"])(this.skyBox)?this.skyBox.update(e,this._hdr):void 0;var s=Object(p["a"])(this.sun)?this.sun.update(e,t.passState,this._hdr):void 0;i.sunDrawCommand=Object(p["a"])(s)?s.drawCommand:void 0,i.sunComputeCommand=Object(p["a"])(s)?s.computeCommand:void 0,i.moonCommand=Object(p["a"])(this.moon)?this.moon.update(e):void 0}var u=i.clearGlobeDepth=Object(p["a"])(n)&&(!n.depthTestAgainstTerrain||this.mode===de["a"].SCENE2D),c=i.useDepthPlane=u&&this.mode===de["a"].SCENE3D;c&&this._depthPlane.update(e),i.renderTranslucentDepthForPick=!1,i.useWebVR=this._useWebVR&&this.mode!==de["a"].SCENE2D&&!r;for(var m=e.mode===de["a"].SCENE3D?e.occluder:void 0,d=e.cullingVolume,h=Ei.planes,f=0;f<5;++f)h[f]=d.planes[f];d=Ei,i.isSkyAtmosphereVisible=Object(p["a"])(i.skyAtmosphereCommand)&&i.isReadyForAtmosphere,i.isSunVisible=this.isVisible(i.sunDrawCommand,d,m),i.isMoonVisible=this.isVisible(i.moonCommand,d,m);var l=this.specularEnvironmentMaps,_=this._specularEnvironmentMapAtlas;!Object(p["a"])(l)||Object(p["a"])(_)&&_.url===l?!Object(p["a"])(l)&&Object(p["a"])(_)&&(_.destroy(),this._specularEnvironmentMapAtlas=void 0):(_=_&&_.destroy(),this._specularEnvironmentMapAtlas=new re["a"](l)),Object(p["a"])(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.update(e)},Nt.prototype.resolveFramebuffers=function(e){var t=this._context,i=this._frameState,a=this._environmentState,r=this._view,o=r.globeDepth,n=a.useOIT,s=a.useGlobeDepthFramebuffer,u=a.usePostProcess,c=a.originalFramebuffer,m=s?o.framebuffer:void 0,d=r.sceneFramebuffer.getFramebuffer(),p=r.sceneFramebuffer.getIdFramebuffer();if(a.separatePrimitiveFramebuffer&&o.executeMergeColor(t,e),n&&(e.framebuffer=u?d:c,r.oit.execute(t,e)),u){var f=d;s&&!n&&(f=m);var l=this.postProcessStages,_=f.getColorTexture(0),v=p.getColorTexture(0),g=Object(h["a"])(m,d).depthStencilTexture;l.execute(t,_,g,v),l.copy(t,c)}n||u||!s||(e.framebuffer=c,o.executeCopyColor(t,e));var b=i.useLogDepth;if(this.debugShowGlobeDepth&&s){var C=ai(this,this.debugShowDepthFrustum-1);C.executeDebugGlobeDepth(t,e,b)}if(this.debugShowPickDepth&&s){var w=this._picking.getPickDepth(this,this.debugShowDepthFrustum-1);w.executeDebugPickDepth(t,e,b)}},Nt.prototype.initializeFrame=function(){120===this._shaderFrameCount++&&(this._shaderFrameCount=0,this._context.shaderCache.destroyReleasedShaderPrograms(),this._context.textureCache.destroyReleasedTextures()),this._tweens.update(),this._screenSpaceCameraController.update(),Object(p["a"])(this._deviceOrientationCameraController)&&this._deviceOrientationCameraController.update(),this.camera.update(this._mode),this.camera._updateCameraChanged()};var ji=new u["a"];function Ni(e){var t=e._frameState,i=e.context,r=i.uniformState,o=e._defaultView;e._view=o,e.updateFrameState(),t.passes.render=!0,t.passes.postProcess=e.postProcessStages.hasSelected,t.tilesetPassState=Bt;var s=Object(h["a"])(e.backgroundColor,u["a"].BLACK);e._hdr&&(s=u["a"].clone(s,ji),s.red=Math.pow(s.red,e.gamma),s.green=Math.pow(s.green,e.gamma),s.blue=Math.pow(s.blue,e.gamma)),t.backgroundColor=s,e.fog.update(t),r.update(t);var c=e.shadowMap;Object(p["a"])(c)&&c.enabled&&(n["a"].negate(r.sunDirectionWC,e._sunCamera.direction),t.shadowMaps.push(c)),e._computeCommandList.length=0,e._overlayCommandList.length=0;var m=o.viewport;m.x=0,m.y=0,m.width=i.drawingBufferWidth,m.height=i.drawingBufferHeight;var d=o.passState;d.framebuffer=void 0,d.blendingEnabled=void 0,d.scissorTest=void 0,d.viewport=a["a"].clone(m,d.viewport),Object(p["a"])(e.globe)&&e.globe.beginFrame(t),e.updateEnvironment(),e.updateAndExecuteCommands(d,s),e.resolveFramebuffers(d),d.framebuffer=void 0,mi(e,d),Object(p["a"])(e.globe)&&(e.globe.endFrame(t),e.globe.tilesLoaded||(e._renderRequested=!0)),i.endFrame()}function Li(e,t){try{t(e)}catch(i){if(e._renderError.raiseEvent(e,i),e.rethrowRenderErrors)throw i}}function Ai(e){return e._picking.updateMostDetailedRayPicks(e)}function Vi(e){var t=e._frameState;kt.camera=t.camera,kt.cullingVolume=t.cullingVolume;var i=e.primitives;i.updateForPass(t,kt)}function Bi(e){var t=e._frameState,i=t.camera;if(i.hasCurrentFlight()){Wt.camera=e.preloadFlightCamera,Wt.cullingVolume=e.preloadFlightCullingVolume;var a=e.primitives;a.updateForPass(t,Wt)}}function ki(e){e.primitives.updateForPass(e._frameState,Ut)}Nt.prototype.render=function(e){this._preUpdate.raiseEvent(this,e);var t=this._frameState;t.newFrame=!1,Object(p["a"])(e)||(e=S["a"].now());var i=this._view.checkForCameraUpdates(this),a=!this.requestRenderMode||this._renderRequested||i||this._logDepthBufferDirty||this._hdrDirty||this.mode===de["a"].MORPHING;if(!a&&Object(p["a"])(this.maximumRenderTimeChange)&&Object(p["a"])(this._lastRenderTime)){var r=Math.abs(S["a"].secondsDifference(this._lastRenderTime,e));a=a||r>this.maximumRenderTimeChange}if(a){this._lastRenderTime=S["a"].clone(e,this._lastRenderTime),this._renderRequested=!1,this._logDepthBufferDirty=!1,this._hdrDirty=!1;var o=T["a"].incrementWrap(t.frameNumber,15e6,1);zt(this,o,e),t.newFrame=!0}Li(this,Mi),this.primitives.show&&(Li(this,Ai),Li(this,Vi),Li(this,Bi),a||Li(this,ki)),this._postUpdate.raiseEvent(this,e),a&&(this._preRender.raiseEvent(this,e),t.creditDisplay.beginFrame(),Li(this,Ni)),Fi(this,a),Li(this,Ii),Ri(this),a&&(this._postRender.raiseEvent(this,e),t.creditDisplay.endFrame())},Nt.prototype.forceRender=function(e){this._renderRequested=!0,this.render(e)},Nt.prototype.requestRender=function(){this._renderRequested=!0},Nt.prototype.clampLineWidth=function(e){return Math.max(A["a"].minimumAliasedLineWidth,Math.min(e,A["a"].maximumAliasedLineWidth))},Nt.prototype.pick=function(e,t,i){return this._picking.pick(this,e,t,i)},Nt.prototype.pickPositionWorldCoordinates=function(e,t){return this._picking.pickPositionWorldCoordinates(this,e,t)},Nt.prototype.pickPosition=function(e,t){return this._picking.pickPosition(this,e,t)},Nt.prototype.drillPick=function(e,t,i,a){return this._picking.drillPick(this,e,t,i,a)},Nt.prototype.pickFromRay=function(e,t,i){return this._picking.pickFromRay(this,e,t,i)},Nt.prototype.drillPickFromRay=function(e,t,i,a){return this._picking.drillPickFromRay(this,e,t,i,a)},Nt.prototype.pickFromRayMostDetailed=function(e,t,i){return this._picking.pickFromRayMostDetailed(this,e,t,i)},Nt.prototype.drillPickFromRayMostDetailed=function(e,t,i,a){return this._picking.drillPickFromRayMostDetailed(this,e,t,i,a)},Nt.prototype.sampleHeight=function(e,t,i){return this._picking.sampleHeight(this,e,t,i)},Nt.prototype.clampToHeight=function(e,t,i,a){return this._picking.clampToHeight(this,e,t,i,a)},Nt.prototype.sampleHeightMostDetailed=function(e,t,i){return this._picking.sampleHeightMostDetailed(this,e,t,i)},Nt.prototype.clampToHeightMostDetailed=function(e,t,i){return this._picking.clampToHeightMostDetailed(this,e,t,i)},Nt.prototype.cartesianToCanvasCoordinates=function(e,t){return he["a"].wgs84ToWindowCoordinates(this,e,t)},Nt.prototype.completeMorph=function(){this._transitioner.completeMorph()},Nt.prototype.morphTo2D=function(e){var t,i=this.globe;t=Object(p["a"])(i)?i.ellipsoid:this.mapProjection.ellipsoid,e=Object(h["a"])(e,2),this._transitioner.morphTo2D(e,t)},Nt.prototype.morphToColumbusView=function(e){var t,i=this.globe;t=Object(p["a"])(i)?i.ellipsoid:this.mapProjection.ellipsoid,e=Object(h["a"])(e,2),this._transitioner.morphToColumbusView(e,t)},Nt.prototype.morphTo3D=function(e){var t,i=this.globe;t=Object(p["a"])(i)?i.ellipsoid:this.mapProjection.ellipsoid,e=Object(h["a"])(e,2),this._transitioner.morphTo3D(e,t)},Nt.prototype.isDestroyed=function(){return!1},Nt.prototype.destroy=function(){this._tweens.removeAll(),this._computeEngine=this._computeEngine&&this._computeEngine.destroy(),this._screenSpaceCameraController=this._screenSpaceCameraController&&this._screenSpaceCameraController.destroy(),this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this._primitives=this._primitives&&this._primitives.destroy(),this._groundPrimitives=this._groundPrimitives&&this._groundPrimitives.destroy(),this._globe=this._globe&&this._globe.destroy(),this.skyBox=this.skyBox&&this.skyBox.destroy(),this.skyAtmosphere=this.skyAtmosphere&&this.skyAtmosphere.destroy(),this._debugSphere=this._debugSphere&&this._debugSphere.destroy(),this.sun=this.sun&&this.sun.destroy(),this._sunPostProcess=this._sunPostProcess&&this._sunPostProcess.destroy(),this._depthPlane=this._depthPlane&&this._depthPlane.destroy(),this._transitioner=this._transitioner&&this._transitioner.destroy(),this._debugFrustumPlanes=this._debugFrustumPlanes&&this._debugFrustumPlanes.destroy(),this._brdfLutGenerator=this._brdfLutGenerator&&this._brdfLutGenerator.destroy(),this._picking=this._picking&&this._picking.destroy(),this._defaultView=this._defaultView&&this._defaultView.destroy(),this._view=void 0,this._removeCreditContainer&&this._canvas.parentNode.removeChild(this._creditContainer),this.postProcessStages=this.postProcessStages&&this.postProcessStages.destroy(),this._context=this._context&&this._context.destroy(),this._frameState.creditDisplay=this._frameState.creditDisplay&&this._frameState.creditDisplay.destroy(),Object(p["a"])(this._performanceDisplay)&&(this._performanceDisplay=this._performanceDisplay&&this._performanceDisplay.destroy(),this._performanceContainer.parentNode.removeChild(this._performanceContainer)),this._removeRequestListenerCallback(),this._removeTaskProcessorListenerCallback();for(var e=0;e<this._removeGlobeCallbacks.length;++e)this._removeGlobeCallbacks[e]();return this._removeGlobeCallbacks.length=0,Object(l["a"])(this)};t["a"]=Nt}}]);